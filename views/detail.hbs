<h1>
  {{ biz.icon }} {{ biz.movie_name }} {{ biz.icon }}
</h1>

<div style="display: flex; align-items: flex-start;">
<table style="margin-right : 30px;">
  <thead>
    <tr>
      <th colspan="2">
        <h2>ì˜í™” í¬ìŠ¤í„°</h2>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
    <td>
        <div class="flip-card">
            <div class="flip-card-inner">
              <div class="flip-card-front">
                <img src="/images/{{ biz.movie_id }}.png" width="200" class="movie-poster">
              </div>
              <div class="flip-card-back">
                <p>ì¶œì—° ì •ë³´</p>
              </div>
            </div>
          </div>
    </td>
    </tr>
  </tbody>
</table>
<table>
  <thead> 
    <tr>
      <th colspan="2"> 
        <h2>ì˜í™” ì •ë³´</h2> 
      </th>
    </tr>
  </thead>
  <tbody class="padd"> 
    <tr>
      <td class="padd"><b>ë°°ê¸‰ì‚¬</td>
      <td>{{ businessName }}</td>
    </tr>
    <tr>
      <td class="padd"><b>ì¥ë¥´</td>
      <td>{{ biz.genre_name }}</td>
    </tr>
    <tr>
      <td class="padd"><b>ê´€ëŒ ë“±ê¸‰</td>
      <td>{{ biz.age }} ê°€ëŠ¥</td>
    </tr>
    <tr>
      <td class="padd"><b>ìƒì˜ ìƒíƒœ</td>
      <td>{{ biz.can_screen }}</td>
    </tr>
    <tr>
      <td class="padd"><b>ê°œë´‰ì¼</td>
      <td>{{ biz.years }}ë…„  {{ biz.months }} ì›”</td>
    </tr>
    <tr>
      <td class="padd"><b>OTT</td>
      <td>{{ biz.ott }}</td>
    </tr>
    <tr>
      <td class="padd"><b>í‰ê·  í‰ì </td>
      <td>{{ avg }}</td>
    </tr>
  </tbody>
</table>
</div>
<br><br><br>

<h2>â­ í‰ì  â­</h2>
<table>
  <thead>
    <tr>
      <th>ì¢‹ì•„ìš”</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td>
          <span>ğŸ‘ {{ biz.likes }}</span>
          <button class="small" onclick="putLike({{ biz.movie_id }}, 1)">+</button>
          <button class="small" onclick="putLike({{ biz.movie_id }}, -1)">-</button>
        </td>
      </tr>
  </tbody>
</table>
<br>
<table>
  <thead>
    <tr>
      <th>í‰ì </th>
      <th>ì½”ë©˜íŠ¸</th>
      <th colspan="2">ì¼ì‹œ</th>
    </tr>
  </thead>
  <tbody class="padd">
    {{#each ratings}}
      <tr>
        <td>{{ stars }}</td>
        <td class="padd">{{ comment }}</td>
        <td>{{ created_fmt }}</td>
        <td>
          <button onclick="removeRating({{ rating_id }})">ì‚­ì œ</button>
        </td>
      </tr>
    {{/each}}
  </tbody>
</table>

<br>

<select id="stars">
  <option value="5">5ì </option>
  <option value="4">4ì </option>
  <option value="3">3ì </option>
  <option value="2">2ì </option>
  <option value="1">1ì </option>
</select>
<input id="comment" type="text">
<button onclick="addRating()">ì˜¬ë¦¬ê¸°</button>

<br><br><br>

<a href="/biz-simple?genre=">
   â—€ï¸ ì˜í™” ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°ï¸
</a>

<script>
  function putLike (movie_id, like) {
    if (!confirm('ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì‹œê² ìŠµë‹ˆê¹Œ?')) return
    fetch(`/movie/${movie_id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        like: like
      })
    }).then((response) => response.json()).then(
      (data) => {
        if (data[0].affectedRows === 1) {
          location.reload()
        } else {
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
        }
      }
    )
  }

  function addRating () {
    fetch(`/ratings`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        movie_id: {{ biz.movie_id }},
        stars: document.getElementById('stars').value,
        comment: document.getElementById('comment').value,
      })
    }).then((response) => response.json()).then(
      (data) => {
        console.log(data[0])
        if (data[0].affectedRows === 1) {
          location.reload()
        } else {
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
        }
      }
    )
  }

  function removeRating (rating_id) {
    if (!confirm('ì´ í‰ì ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return

    fetch(`/ratings/${rating_id}`, {
      method: 'DELETE'
    }).then((response) => response.json()).then(
      (data) => {
        console.log(data[0])
        if (data[0].affectedRows === 1) {
          location.reload()
        } else {
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
        }
      }
    )
  }
</script>